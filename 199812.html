<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<title>Sch√∂ne T√∂ne (PC Underground, PC Magazin 12/1998)</title>
</head>
<body>
	<div class="credits">
		<h2>Dieser Artikel erschien erstmals im PC&nbsp;Magazin&nbsp;12/1998. Die Wieder&shy;ver√∂ffentlichung erfolgt mit freundlicher Genehmigung der <a rel="external nofollow noreferrer" href="https://www.weka-media-publishing.de">WEKA&nbsp;Media&nbsp;Publishing&nbsp;GmbH</a>.</h2>
	</div>
	<nav class="pagenav">
		<a rel="prev" href="199811.html">11/1998</a>
		<a href="index.html">Inhalt</a>
		<a rel="next" href="199901.html">1/1999</a>
	</nav>
	<article>
	<header>
		<h2>Demo-Programmierung unter Windows 95/NT</h2>
		<h1>Sch√∂ne <span class="highlight">T√∂ne</span></h1>
		<p class="summary">Nach den visuellen Effekten der letzten Ausgaben warten die <span class="highlight">Programme und Routinen</span> diesmal mit akustischen Reizen auf.</p>
	</header>

	<section>
		<h3>Carsten Dachsbacher</h3>
		<p>Ein PC mit Soundkarte kann Kl√§nge √ºber ein ange&shy;schlossenes Mikrofon aufnehmen oder elektrische Impulse von einer Hi-Fi-Komponente durch die Line-In-Schnittstelle empfangen. Dazu mi√üt er in regelm√§√üigen Zeitabst√§nden die analoge Amplitude der Welle und rechnet die gemessene Spannung in einen digitalen Wert um. Beim Abspielen wandelt die Soundkarte die so erhaltenen Werte wieder in Spannungen zur√ºck, die dann einen Lautsprecher betreiben.</p>
		<p>Entscheidend f√ºr die Klangqualit√§t ist zum einen die Anzahl der gemessenen Werte pro Sekunde (Sampling-Frequenz). Zum anderen spielt die Anzahl der Bits eine Rolle, die zur Repr√§sentation der abgetasteten Spannungswerte benutzt werden. Ein CD-Player arbeitet zum Beispiel mit einer Sampling-Frequenz von 44,1 kHz und 16 Bit pro Abtastwert. Multiplizieren Sie diese 44 100 Abtastwerte pro Sekunde mit dem Platzbedarf von 2 Byte (= 16 Bit) pro Abtastwert, so errechnen Sie einen Speicherbedarf von 88 200 Byte pro Sekunde f√ºr jeden der beiden Stereokan√§le.</p>
		<p>Um die aufgenommenen Musiksignale korrekt reproduzieren zu k√∂nnen, mu√ü die Sampling-Frequenz mindestens doppelt so hoch sein wie die Frequenz des h√∂chsten Tons. Aus dieser allgemein&shy;g√ºltigen Regel (bekannt als Shannon-Theorem) resultiert auch der typische Frequenzgang eines CD-Players bis etwa 22 kHz.</p>
	</section>

	<aside>
		<h2>QUELLTEXTE</h2>
		<div>Die Quelltexte zu diesem Artikel finden Sie in der Datei  <a href="199812.zip">üíæ 199812.zip</a>.</div>
	</aside>

	<section>
		<h2>Qual der Wahl</h2>
		<p>Um eine Demo mit Hinter&shy;grundmusik zu versehen, haben Sie die Wahl zwischen zwei verschiedenen Ans√§tzen.<br>
		‚Ä¢ Sie k√∂nnen das ganze Musikst√ºck aufnehmen, als <i>wav</i>-Datei speichern und parallel zur Demo abspielen. Der Vorteil hierbei ist, da√ü Sie nur einmal die Ausgabe starten m√ºssen und sich um nichts weiteres zu k√ºmmern brauchen. Au√üerdem ben√∂tigt die CPU zum Abspielen der Sample-Daten praktisch keine Rechenzeit. Negativ schl√§gt der relativ hohe Speicher&shy;verbrauch zu Buche. Wie Sie dem etwas entgegenwirken, erfahren Sie sp√§ter.<br>
		‚Ä¢ Bei der zweiten Variante werden einzelne Instrumente aufgenommen und die Musiknoten zu den Instrumenten&shy;daten gespeichert. Sie haben dann daf√ºr zu sorgen, da√ü die Instrumente zu den gegebenen Zeitpunkten in der richtigen Tonh√∂he abgespielt werden. Dieses Verfahren nutzen die noch vom Commodore Amiga stammenden <i>Modules</i> (MOD-Format) und die <i>Extended Modules</i> (XM-Format), welche eine erweiterte Funktionalit√§t besitzen.</p>
		<p>Haupts√§chlich fallen zwei verschiedene Berechnungen mit den Sample-Daten an. Zuerst m√∂chten Sie sicherlich die Lautst√§rke eines Instruments beeinflussen. Daf√ºr multiplizieren Sie jeden Sample-Wert mit einem Faktor und ver√§ndern somit die Amplitude, also die Lautst√§rke des Samples.</p>
		<p>Die zweite wichtige Operation ist das Mischen der einzelnen Kan√§le bzw. der Instrumente. Ohne Wavetable-Soundkarte mu√ü die Software diese rechen&shy;intensive Aufgabe √ºbernehmen. Moderne PCs sind schnell genug. Sie berechnen die Kl√§nge in Echtzeit und f√ºgen zus√§tzlich Effekte wie Chorus oder Reverb (Echo) hinzu. Das Mischen der Sample-Daten entspricht einer Addition.</p>
	</section>

	<section>
		<h2>Module komponieren</h2>
		<p>FastTracker II ist ein Musikprogramm, mit dem Sie selbst MODund XM-Musikst√ºcke schreiben. Um Ihnen den Einstieg ins Komponieren mit FastTracker II (auf unserer Heft-CD) zu erleichtern, gibt Ihnen PC Magazin wertvolle Tips zur Hand.</p>
		<h4>Profi-Einstieg</h4>
		<p>Wie auch alle anderen Tracker auf dem Markt ist FastTracker II kein Programm, um schnell oder einfach Musik zu machen. Es erfordert eine gewisse Einarbeitung und Gew√∂hnung, um effektiv mit diesem m√§chtigen, aber unkonven&shy;tionellen Tool umzugehen.</p>
		<p>Generell ist ein sogenanntes Modul anders aufgebaut als MIDI-Dateien. Der Ansatz der Module ist ‚Äì da sie urspr√ºnglich vom Amiga stammen ‚Äì sehr Hardware-nah und effizient gehalten. Generell gibt es eine Anzahl von Kan√§len (normalerweise zwischen 4 und 32). Jeder Kanal entspricht einer Mono-Audiodatei, √§hnlich einer <i>wav</i>-Datei. Im Gegensatz zu Harddisk-Recording-Software bieten Tracker jedoch die M√∂glichkeit, diese Kl√§nge beliebig in Tonh√∂he und Lautst√§rke zu modifizieren. So entstehen aus diesen einzelnen Samples komplexe polyphone (vielstimmige) Musikst√ºcke.</p>
		<p>Die Musikdaten sind deshalb in sogenannten Patterns zusammengefa√üt. In einem Pattern gibt es f√ºr jeden Kanal eine Spalte, in der untereinander die Events stehen. Jedes Event besteht aus vier Komponenten:<br>
		‚Ä¢ einer Note, die die Tonh√∂he des abzuspielenden Instruments angibt;<br>
		‚Ä¢ einer Instrumente&shy;nnummer, die das Instrument bzw. das Sample spezifiziert;<br>
		‚Ä¢ einer Lautst√§rke&shy;spalte, die die Lautst√§rke des Tons bestimmt<br>
		‚Ä¢ und einer Effektspalte, in der Sie mittels einer dreistelligen Hexadezi&shy;malzahl bestimmte Modulationen auf den Ton anwenden.</p>
		<figure class="floatright">
			<img src="assets/199812_1.png" width="640" height="400" alt="HERZST√úCK DES FASTTRACKER II:< Im Pattern-Editor weisen Sie jedem Instrument Tonh√∂he, Lautst√§rke und Effekte zu.">
			<figcaption><span>HERZST√úCK DES FASTTRACKER II:</span> Im Pattern-Editor weisen Sie jedem Instrument Tonh√∂he, Lautst√§rke und Effekte zu.</figcaption>
		</figure>
		<p>Eine Zeile in einem Pattern entspricht einem bestimmten Zeitintervall. Im Gegensatz zu einer Event-Liste in √ºblichen Sequenzer&shy;programmen ist dieser Zeitablauf jedoch starr, das hei√üt, die Liste wird mit einer mehr oder weniger konstanten Geschwindig&shy;keit von oben nach unten abgearbeitet.</p>
		<p>In der sogenannten Order-Liste reihen Sie die Patterns aneinander und f√ºgen so einen Song zusammen. Alle Patterns in der Orderliste werden nacheinander abgespielt. Wenn Sie sich in die ‚Äì leider nicht optimale ‚Äì Benutzer&shy;f√ºhrung von FastTracker II eingearbeitet haben, sind Sie mit ein wenig √úbung bald in der Lage, professionelle Musikst√ºcke zu komponieren.</p>
		<p>Im Editor von FastTracker II stellen Sie schnell fest, da√ü das ganze Programm mit Hexadezi&shy;malzahlen arbeitet. Der Grund daf√ºr ist die kompaktere Darstellung der verwendeten Parameter f√ºr die Bildschirm&shy;ausgabe. Das ist etwas gew√∂hnungs&shy;bed√ºrftig, aber die hexadezimale Numerierung der Pattern-Zeilen erscheint bei der heutigen 4/4-Takt-dominierten Musik wesentlich intuitiver. Sie k√∂nnen damit Abst√§nde von beispielsweise 4, 8 oder 16 Zeilen schneller erkennen.</p>
		<p>Bevor Sie sich ans Werk machen, sollten Sie sich die Online-Hilfe und die mitgelieferte Dokumentation ansehen. Dort finden Sie einige Tastatur&shy;befehle, die die Arbeit mit dem Editor wesentlich erleichtern. Da die bereits erw√§hnten Effektspalten in den Patterns mit Zahlen arbeiten, sollten Sie auch diese in der Hilfe nachschlagen.</p>
		<h4>Das Sound-Cockpit</h4>
		<p>Nach dem Programmstart sehen Sie den sogenannten Arbeits&shy;bildschirm. Dieser ist in mehrere Bereiche unterteilt. In der unteren H√§lfte befindet sich normalerweise die Arbeitsfl√§che, also der Pattern-Editor, w√§hrend Sie im oberen Bildschirmteil n√ºtzliche Anzeigen oder Hilfsbild&shy;schirme sehen. Im Normalfall finden Sie links oben die Order-Liste, diverse Einstellungen, eine Speicher&shy;anzeige und einen Bereich mit Oszilloskop-Darstellungen. Diese zeigen w√§hrend des Abspielens den Zustand der einzelnen Kan√§le an. Im rechten oberen Teil befinden sich zwei Reihen mit Schaltfl√§chen zum Aufrufen der verschiedenen Funktionen und Editoren, rechts daneben die Liste der Instrumente und ihrer Samples.</p>
		<p>Da FastTracker II aus der DOS-Zeit stammt, steht zuerst die Konfiguration Ihrer Soundkarte an. Im <i>Config</i>-Men√º w√§hlen Sie in den Abschnitten <i>Output</i><i>Device</i> und <i>Sampling Device</i> Ihre Soundkarte aus. Im Fall einer Sound-Blaster-kompatiblen Karte sollten Sie zus√§tzlich die IRQund DMA-Einstellungen √ºberpr√ºfen. Au√üerdem empfiehlt es sich f√ºr eine m√∂glichst gute Klangqualit√§t, die Optionen <i>Interpolation</i>, <i>16bit mixing</i> und <i>Stereo</i> zu aktivieren. Um die maximale Sampling-Frequenz f√ºr die Ausgabe zu w√§hlen, klicken Sie rechts oben neben der Frequenz&shy;tabelle auf <i>Max</i>.</p>
		<figure class="floatright">
			<img src="assets/199812_3.png" width="640" height="400" alt="CYBER-KLAVIER: FastTracker II verwandelt die PC-Tastatur in ein virtuelles Keyboard.">
			<figcaption><span>CYBER-KLAVIER:</span> FastTracker II verwandelt die PC-Tastatur in ein virtuelles Keyboard.</figcaption>
		</figure>
		<p>Um ein Modul zu laden, klicken Sie oben in der Mitte auf <i>Disk op.</i> und w√§hlen den entsprechenden Namen im Dateiauswahl&shy;fenster links oben. Mit der Schaltfl√§che <i>Save</i> speichern Sie ein Modul unter dem aktuellen Namen ‚Äì dieser ist am unteren Fensterrand eingeblendet. Um diesen Namen zu √§ndern, klicken Sie ihn ‚Äì wie bei allen Textfeldern in FastTracker II ‚Äì mit der rechten Maustaste an. M√∂chten Sie einen Sample als Instrument laden, klicken Sie in der Instrumenten&shy;liste auf die Position, an der es eingetragen werden soll, und auf den Dateinamen in Dateiselektor.</p>
		<p>Im unteren Teil des Bildschirms sehen Sie entweder den Pattern-, den Sample- oder den Instrumenten&shy;editor. Der Pattern-Editor ist das Herzst√ºck des Tracker. Hier geben Sie die Notendaten in die Patterns ein. Dazu benutzen Sie die Tastatur als virtuelles Keyboard: Die QWERTZ-Reihe stellt die wei√üen, die Zahlenreihe die schwarzen Tasten dar. QUERTZ ist ein nach der Anordnung der Tasten auf der Tastatur entstandenes Kunstwort zur Unterscheidung der englischen (QWERTY) und der deutschen (QWERTZ) Tastatur. Der Cursor befindet sich immer in der hervor&shy;gehobenen Mittelzeile des Pattern-Editors und ist mit einer Umrandung markiert.</p>
		<p>Sie bewegen den Cursor mit den Pfeiltasten oder der <i>[Tab]</i>-Taste, um zwischen den Kan√§len zu wechseln. Vorsicht: Auch wenn der Pattern-Editor nicht aktiv ist und Sie zum Beispiel den Sample-Editor sehen, k√∂nnen Sie den Inhalt des Pattern modifizieren. Mit der Leertaste wechseln Sie zwischen dem Anh√∂rmodus (die Samples werden einfach nur gespielt, wenn Sie die Tasten dr√ºcken) und dem Editiermodus (die Noten werden in das Pattern eingetragen). Den Editiermodus erkennen Sie an der etwas helleren Farbe des Bildschirm&shy;rahmens.</p>
		<figure class="floatright">
			<img src="assets/199812_2.png" width="640" height="400" alt="SAMPLE-EDITOR: die virtuelle Stimmgabel zum Feintuning der Instrumente">
			<figcaption><span>SAMPLE-EDITOR:</span> die virtuelle Stimmgabel zum Feintuning der Instrumente</figcaption>
		</figure>
		<p>Befindet sich der Cursor √ºber der Notenspalte, k√∂nnen Sie Noten eingeben oder mit der Feststelltaste ein <i>Key-off</i>-Event setzen. Im letzteren Fall stoppt die Sample-Ausgabe des betreffenden Kanals an dieser Position. Bei den anderen Spalten geben Sie die Lautst√§rke und die Effekte ein, deren Zahlencodes Sie der Online-Hilfe entnehmen.</p>
		<p>Im Sample-Editor schlie√ülich k√∂nnen Sie die Sample-Daten der Instrumente betrachten und wie mit einem Wave-Bearbeitungs&shy;programm modifizieren.</p>
	</section>

	<section>
		<h2>Sound-Bibliothek benutzen</h2>
		<p>Um Ihre Kompositionen in Ihre Demo zu integrieren, bedienen Sie sich am besten einer fertigen Bibliothek wie der MIDAS Audio Library (auf unserer Heft-CD). Die Gr√ºnde, warum wir Ihnen hier eine fertige Bibliothek vorstellen, sind vielf√§ltiger Natur: Zum einen w√ºrde die Entwicklung eines eigenen MOD-Players mit all seinen Feinheiten mehrere Ausgaben von PC Underground f√ºllen ‚Äì ganz zu schweigen von einem XM-Player.</p>
		<figure class="floatleft">
			<img src="assets/199812_5.png" width="320" height="257" alt="UNSER MOD-PLAYER ist f√ºr die aktuelle Statusanzeige im Fenster verantwortlich.">
			<figcaption><span>UNSER MOD-PLAYER</span> ist f√ºr die aktuelle Statusanzeige im Fenster verantwortlich.</figcaption>
		</figure>
		<p>Zum anderen ist es nicht immer sinnvoll, gleich das Rad neu zu erfinden. Deswegen kommt das MIDAS-Soundsystem auch in der Demoszene sehr oft zum Einsatz. Es ist zweifelsfrei eines der besten und bietet eine einfach Schnittstelle, um MOD- und XM-Dateien unter DOS, Windows oder Linux abzuspielen.</p>
		<p>Aktuelle Updates und weitere Informationen bekommen Sie unter <a href="https://www.s2.org/midas" rel="external nofollow noreferrer">www.s2.org/midas</a><br>
		Au√üer dem MIDAS-Paket, in dem eine Vielzahl von Beispiel&shy;programmen und Dokument&shy;ationen enthalten sind, ben√∂tigen Sie nur noch eine kleine √Ñnderung am Demo-Basissystem: Sie m√ºssen sichergehen, da√ü MIDAS immer korrekt beendet wird. Deshalb f√ºgen Sie dem Basissystem au√üer <i>demoinit()</i> und <i>demomain()</i> noch <i>demoquit()</i> hinzu. Diese Funktion wird beim Beenden der Demo automatisch aufgerufen.</p>
		<p>Als Beispiel&shy;programm hierzu finden Sie in dieser Ausgabe einen kleinen Module-Player. Dieses Programm verwendet die von MIDAS bereit&shy;gestellten Funktionen, um Informationen √ºber die Musik&shy;wiedergabe zu erhalten:</p>
		<pre><code>
MIDASmoduleInfo info;
MIDASplayStatus status;
MIDASgetModuleInfo(module, &amp;info);
MIDASgetPlayStatus(playHandle, &amp;status);
		</code></pre>
		<p>Die beiden Strukturen <i>&amp;info</i> und <i>&amp;status</i> werden von den aufgerufenen Funktionen mit Daten gef√ºllt und sind folgenderma√üen definiert:</p>
		<pre><code>
typedef struct {
	// Titel des Module
	char songName[32];
	// L√§nge der Order-List
	unsigned songLength;
	// Anzahl der ver-
	// schiedenen Patterns
	unsigned numPatterns;
	// Anzahl der Instrumente
	unsigned numInstruments;
	// Anzahl der Kan√§le
	unsigned numChannels;
} MIDASmoduleInfo;

struct {
	// Position in der Order-List
	unsigned position;
	// Pattern an dieser Stelle
	unsigned pattern;
	// aktuelle Zeile im Pattern
	unsigned row;
	// Synchronisationsinfo
	int syncInfo;
	unsigned songLoopCount;
} MIDASplayStatus;
		</code></pre>
		<p>Der Module-Player stellt den Titel des Module in der Titelzeile dar, w√§hrend er die momentane Position, das Pattern und die Zeile kontinuierlich im Fenster aktualisiert. Die Routinen, mit denen Sie die MIDAS-Bibliothek nutzen und Fehler&shy;meldungen abfangen, finden Sie in der Datei <i>UseMIDAS.cpp</i>.</p>
	</section>

	<aside>
		<h2>FUNKTIONEN DER MIDAS-SOUND-BIBLIOTHEK</h2>
		<div>
			<p>Wenn Sie die Datei midasdll.lib in Ihre Demo linken und die zugeh√∂rige Header-Datei einbinden, stehen Ihnen folgende Befehle und Datentypen zur Verf√ºgung, mit denen Sie bereits das Abspielen starten k√∂nnen:</p>
			<pre><code>
MIDASmodule module;
MIDASmodulePlayHandle playHandle;

//Startet MIDAS und ini-
//tialisiert die Soundausgabe
MIDASstartup();
MIDASinit();

//Legt fest, da√ü MIDAS auto-
//matisch im Hintergrund l√§uft
MIDASstartBackgroundPlay(0);

//L√§dt die xm-Datei
module = MIDASloadModule("musik.xm");

//Beginnt das Abspielen
playHandle = MIDASplayModule(module,TRUE);

//Hier kann Ihr Programm wie
//bisher ablaufen

//Abspielen stoppen und
//Speicher freigeben
MIDASstopModule(playHandle);
MIDASfreeModule(module);

//Beendet MIDAS
MIDASclose();
			</code></pre>
		</div>
	</aside>

	<section>
		<h2>Musik im <i>wav</i>-Format</h2>
		<p>Das Komponieren mit FastTracker II ben√∂tigt ohne Zweifel einiges an Erfahrung und erscheint auf den ersten Blick sehr aufwendig. Einfacher geht es mit Musik&shy;programmen wie jenen aus der eJay-Reihe. Anstatt wie bei Tracker die Noten f√ºr einzelne Instrumente anzugeben, f√ºgen Sie hier vorgefertigte Klangbausteine zu einem Musikst√ºck zusammen. Dabei stehen Ihnen mehrere Kan√§le zur Verf√ºgung, in denen Sie mit automatischer Positionierungs&shy;hilfe per Drag&amp;Drop die Kl√§nge aus einer Auswahl von mehreren hundert Samples aneinander&shy;reihen k√∂nnen.</p>
		<p>Abh√§ngig vom gew√§hlten eJay-Programm, das es f√ºr die Musik&shy;richtungen Rave, Dance und Hip-Hop gibt, k√∂nnen Sie weitere Effekte und eigene Klangbausteine hinzuf√ºgen. Mit solch einem Programm erzielen Sie in k√ºrzester Zeit beeindruckende Ergebnisse, die Sie als <i>wav</i>-Datei speichern.</p>
		<figure class="floatright">
			<img src="assets/199812_4.jpg" width="472" height="353" alt="MACHT SPASS: Mit Rave-eJay schaffen Sie die Grundlagen f√ºr Ihre sp√§tere D.J.-Karriere.">
			<figcaption><span>MACHT SPASS:</span> Mit Rave-eJay schaffen Sie die Grundlagen f√ºr Ihre sp√§tere D.J.-Karriere.</figcaption>
		</figure>
		<p>Wie Sie bereits wissen, ben√∂tigen <i>wav</i>-Dateien im Vergleich zu <i>mid</i>-, <i>mod</i> oder <i>xm</i>-Dateien relativ viel Speicherplatz. Abhilfe k√∂nnte das MP3-Musikformat schaffen, das hervorragende Kompressions&shy;raten erzielt. Allerdings ist es nicht so einfach, dieses Format wieder abzuspielen, und es gibt auch keine frei erh√§ltlichen Bibliotheken.</p>
		<p>Deshalb reduzieren Sie die Datenmenge mit anderen Mitteln. Der erste Schritt ist die Wahl einer niedrigeren Sample-Frequenz, da Sie f√ºr eine Demo nicht die volle CD-Qualit√§t ben√∂tigen. Au√üerdem brauchen Sie f√ºr gute Ergebnisse nicht unbedingt 16 Bit je Sample-Wert. Oftmals sind 8 Bit aber zu wenig.</p>
		<p>Um diesem Dilemma zu entgehen, nutzen Sie eine Eigenschaft des menschlichen H√∂rapparates aus: Das Ohr nimmt bei leisen Klangpassagen kleinere Unterschiede der Lautst√§rke wahr als bei lauten. Also verwenden Sie bei niedrigen Amplituden pr√§zisere Sample-Werte, w√§hrend Sie sich bei hohen Amplituden ungenaue Werte leisten k√∂nnen.</p>
		<p>Wenn eine Soundkarte die Amplitude <i>a</i> in den Sample-Wert <i>s</i> √ºberf√ºhrt, wandelt sie <i>2*a</i> in <i>2*s</i> um. Es besteht also ein linearer Zusammenhang zwischen der Amplitude und dem Sample-Wert, das hei√üt die Genauigkeit eines Sample-Wert-Schrittes entspricht immer derselben √Ñnderung der Amplitude. Um sich nun die Schw√§chen des Menschen beim H√∂ren zunutze zu machen, verwenden Sie statt einer linearen Skala eine nichtlineare. So k√∂nnen Sie zum Beispiel 16-Bit-Werte in nichtlineare 8-Bit-Werte umwandeln und erhalten ein deutlich besseres Ergebnis als normalerweise bei 8 Bit. Ausgehend von einem unsigned 16-Bit-Sample-Wert errechnen Sie den neuen nichtlinearen Wert aus</p>
		<pre><code>
nichtlinearer_wert =
	255.0 * (pow(2.0, samplewert / 65536.0) - 1.0);
		</code></pre>
		<p>Mit dieser einfachen Formel reduzieren Sie den Umfang der <i>wav</i>-Daten deutlich, ohne einen gro√üen Verlust an Klangqualit√§t hinzunehmen. Bevor Sie die Daten wieder abspielen, m√ºssen Sie diese nat√ºrlich zur√ºck&shy;konvertieren. Dies geschieht mit einer einfachen Formel:</p>
		<pre><code>
samplewert =
	65535.0 * log10(1.0 + wert/ 256.0) / log10(2) - 32767.0;
		</code></pre>
		<p>Die Variable <i>samplewert</i> ist hier 16 Bit signed.</p>
		<p>Sind Sie mit dem bisherigen Ergebnis noch nicht zufrieden, wenden Sie einen sogenannten Low-Pass-Filter auf die zur√ºck&shy;konvertierten Sample-Daten an. Dieser Filter schw√§cht die Lautst√§rke von Kl√§ngen, deren Frequenzen √ºber einer gewissen Grenzfrequenz liegen, deutlich ab.</p>
		<p>Ein Klang ist ‚Äì in der Realit√§t ‚Äì immer eine Mischung aus vielen verschiedenen Frequenzen. Das Rauschen allerdings, das Sie bei den Samples h√∂ren, besteht haupts√§chlich aus hohen Frequenzen, die sie mit diesem Filter eliminieren.</p>
		<p>Den denkbar einfachsten Low-Pass-Filter erhalten Sie, indem Sie den Mittelwert jeweils zweier Sample-Werte bilden:</p>
		<pre><code>
for(i = 1;i &lt; anzahl_werte; i++)
	wert[i] = (wert[i] + wert[i - 1]) / 2;
		</code></pre>
		<p>Als letzter Punkt ist noch die Wiedergabe √ºber Ihre Soundkarte zu kl√§ren. F√ºr <i>wav</i>-Dateien steht Ihnen unter Windows die <i>PlaySound</i>-Funktion zur Verf√ºgung, die Sie allerdings aus mehreren Gr√ºnden in Demos nicht verwenden sollten. Beispielsweise haben Sie damit nicht die M√∂glichkeit, an einer bestimmten Stelle die Soundausgabe anzuhalten und sie danach wieder fortzusetzen.</p>
		<p>Au√üerdem k√∂nnen Sie nicht feststellen, an welcher Position innerhalb der Sample-Daten Sie sich befinden. Genau dies brauchen Sie aber, um die seit Abspielbeginn verstrichene Zeit zu berechnen und damit die Synchroni&shy;sation mit Ihrer Demo zu gew√§hrleisten.</p>
		<p>Sie verwenden also besser das Waveform Audio Interface von Windows. Es stellt die n√∂tigen Funktionen zur Verf√ºgung, um beliebige <i>wav</i>-Daten abzuspielen.</p>
		<p>Sie k√∂nnen auch bestimmte Teile eines Sample mit dem WaveOut-Device loopen, also mehrmals abspielen. So reduzieren Sie die Datenmenge erneut, da Sie identische Passagen eines Musikst√ºcks ‚Äì in der Praxis ein h√§ufiger Fall ‚Äì nur einmal speichern.</p>
		<p>Um die Wiedergabe vorzubereiten, √ºbergeben Sie der Funktion <i>waveOut-</i><i>Open</i> eine <i>Waveformatex</i>-Struktur. Dort tragen Sie die von Ihnen gew√ºnschten Parameter f√ºr die Soundausgabe ein. Das geeignete Multimedia-Ger√§t sucht sich <i>waveOutOpen</i> dann selbst√§ndig:</p>
		<pre><code>
WAVEFORMATEX format;
HWAVEOUT wavehandle;
WAVEHDR wheader;

// ungepackte Sample-Daten
format.wFormatTag = WAVE_FORMAT_PCM;
// Monoausgabe
format.nChannels = 1;
// Sampling-Frequenz
format.nSamplesPerSec = 22050;
// Bytes pro Sekunde
format.nAvgBytesPerSec = 22050 * 2;
format.nBlockAlign = 2;

// 16 Bits pro Sample
format.wBitsPerSample = 16;
format.cbSize = 0;

waveOutOpen(&amp;wavehandle,
	WAVE_MAPPER, &amp;format, 0, 0, 0);
		</code></pre>
		<p>Nun haben Sie mit <i>wavehandle</i> das richtige Ausgabeger√§t. Anschlie√üend bereiten Sie den Datenblock vor, der an die Soundkarte geschickt werden soll:</p>
		<pre><code>
// Zeiger auf die Sample-Daten
wheader.lpData = (char*)wave16bit;

// Gr√∂√üe des Datenblocks/Byte
wheader.dwBufferLength = size;
wheader.dwBytesRecorded = 0;
wheader.dwUser = 0;
wheader.dwFlags = 0;
wheader.dwLoops = 0;

waveOutPrepareHeader(wavehandle, &amp;wheader, sizeof(wheader));
		</code></pre>
		<p>Damit ist die Soundausgabe initialisiert. Den Startschu√ü zum Abspielen geben Sie mit folgender Zeile:</p>
		<pre><code>
waveOutWrite(wavehandle, &amp;wheader,sizeof(wheader));
		</code></pre>
		<p>Um Ihre Demo zu jedem Zeitpunkt mit der gew√ºnschten Musik zu synchroni&shy;sieren, holen Sie mit der Zeile</p>
		<pre><code>
MMTIME mmtime;
waveOutGetPosition(wavehandle, &amp;mmtime,sizeof(mmtime));
		</code></pre>
		<p>die aktuelle Abspiel&shy;position ein, aus der Sie dann die verstrichene Zeit seit Sample-Beginn berechnen. Sie k√∂nnen die Zeit auch mit Hilfe der Funktion <i>GetDemoTime()</i> aus der Basis&shy;bibliothek bestimmen, allerdings sollten Sie diese Funktion nur bei k√ºrzeren <i>wav</i>-St√ºcken verwenden. Auf der Heft-CD finden Sie eine vollst√§ndige Demo, die ein komprimiertes Sample l√§dt und dazu synchronisiert einige Effekte der letzten Ausgaben demonstriert.</p>
		<p>Auch f√ºr dieses Programm ben√∂tigen Sie die <i>demoquit()</i>-Funktion zum Beenden der <i>wav</i>-Ausgabe:</p>
		<pre><code>
waveOutReset(wavehandle);
waveOutUnprepareHeader(
wavehandle,&amp;wheader, sizeof(wheader));
waveOutClose(wavehandle);
		</code></pre>
		<p>Nun haben Sie alle Werkzeuge in der Hand, um Ihre eigene Demo mit allem Drum und Dran zu schreiben. Seien Sie kreativ: Wir sind gespannt auf Ihre Resultate!</p>
	</section>
	<footer>
		<p>R√ºdiger Pein / J√∂rg Reitter</p>
		<p>¬© 1998 WEKA Computerzeitschriften Verlag</p>
	</footer>
	</article>
	<nav class="pagenav">
		<a rel="prev" href="199811.html">11/1998</a>
		<a href="index.html">Inhalt</a>
		<a rel="next" href="199901.html">1/1999</a>
	</nav>
</body>
</html>
